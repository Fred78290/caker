#!/bin/sh

set -e

mkdir -p /usr/local/bin

cat <<EOF > /usr/local/bin/caked
#!/bin/sh
exec "/Library/Application Support/Caker/Caker.app/Contents/MacOS/caked" "\$@"
EOF
chmod +x /usr/local/bin/caked

cat <<EOF > /usr/local/bin/cakectl
#!/bin/sh
exec "/Library/Application Support/Caker/Caker.app/Contents/Resources/cakectl" "\$@"
EOF

chmod +x /usr/local/bin/cakectl

cat <<EOF > /etc/sudoers.d/caker
# Caker sudoers file
%everyone ALL=(root:wheel) NOPASSWD: /usr/local/bin/caked
EOF

chgroup staff /etc/sudoers.d/caker

chmod 0664 /etc/sudoers.d/caker


# Install the Caker service
caked service install --system
