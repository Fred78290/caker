// limitations under the License.
syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.aldunelabs.caker";
option java_outer_classname = "caked";
option objc_class_prefix = "caked";

package caked;

service Service {
	// Sends a greeting
	rpc Build (BuildRequest) returns (Reply) {}
	rpc Start (StartRequest) returns (Reply) {}
	rpc CakeCommand (CakedCommandRequest) returns (Reply) {}
	rpc Launch (BuildRequest) returns (Reply) {}
	rpc Login (LoginRequest) returns (Reply) {}
	rpc Purge (PurgeRequest) returns (Reply) {}
	rpc Configure (ConfigureRequest) returns (Reply) {}
	rpc WaitIP (WaitIPRequest) returns (Reply) {}
	rpc Stop (StopRequest) returns (Reply) {}
	rpc Remote(RemoteRequest) returns (Reply) {}
	rpc Networks(NetworkRequest) returns (Reply) {}
//	rpc Stream(stream Bytes) returns (stream Bytes);
}

enum Format {
	text = 0;
	json = 1;
}

enum RemoteCommand {
	none = 0;
	add = 1;
	delete = 2;
	list = 3;
}

message StopRequest {
	string name = 1;
	bool force = 2;
}

message WaitIPRequest {
	string name = 1;
	int32 timeout = 2;
}

message NetworkRequest {
	Format format = 1;
}

message RemoteRequestAdd {
	string name = 1;
	string url = 2;
}

message RemoteRequest {
	RemoteCommand command = 1;
	oneof request {
		RemoteRequestAdd add = 2;
		string delete = 3;
		Format format = 4;
	}
}

message Bytes {
	bytes data = 1;
}

message CakedCommandRequest {
	string command = 1;
	repeated string arguments = 2;
}

message BuildRequest {
	string name = 1;
	optional int32 cpu = 2;
	optional int32 memory = 3;
	optional string user = 4;
	optional string password = 22;
	optional string mainGroup = 5;
	optional bool sshPwAuth = 6;
	optional string image = 7;
	optional bytes sshAuthorizedKey = 8;
	optional bytes vendorData = 9;
	optional bytes userData = 10;
	optional bytes networkConfig = 11;
	optional int32 diskSize = 12;
	optional bool autostart = 13;
	optional bool nested = 14;
	optional string forwardedPort = 15;
	optional string mounts = 16;
	optional string netBridged = 17;
	optional bool netSofnet = 18;
	optional string netSoftnetAllow = 19;
	optional bool netHost = 21;
}

message StartRequest {
	string name = 1;
}

message Error {
	int32 code = 1;
	string reason = 2;
}

message PurgeRequest {
	optional string entries = 1;
	optional int32 olderThan = 2;
	optional int32 cacheBudget = 3;
	optional int32 spaceBudget = 4;
	optional bool gc = 5;
}

message ConfigureRequest {
	string name = 1;
	optional int32 cpu = 2;
	optional int32 memory = 3;
	optional int32 diskSize = 4;
	optional bool displayRefit = 5;
	optional bool autostart = 6;
	optional bool nested = 7;
	optional string mounts = 8;
	optional string netBridged = 9;
	optional bool netSoftnet = 10;
	optional string netSoftnetAllow = 1120;
	optional bool netHost = 12;
	optional bool randomMAC = 13;
	optional string forwardedPort = 24;
	optional bool resetForwardedPort = 25;
}

message LoginRequest {
	string username = 1;
	string password = 2;
	bool insecure = 3;
	bool noValidate = 4;
}

message Reply {
  oneof response {
    Error error = 1;
    string output = 2;
  }
}